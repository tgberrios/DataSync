JOB DE AIRFLOW PARA HACERLO DE MONGO EL UPDATE CADA DOMINGO 

ARREGLAR DATA GOVERNANCE PARA QUE ME DE MAS DOMINIOS DE CATEGORIZACION EN LA CASA


2. TIENE QUE HABER UNA MEJOR FORMA DE HACER LOS INCREMENTALES ESTO NO ES LO MEJOR DE SUBIR DE UNO EN UNO O ALGO ASI 
3. ALGUNAS COSAS EN STREAMING DATA DEBERIAN RUNEAR EN THREADS SEPARADOS PERO EN ORDEN PARA QUE NO LEERDEEN LA EJECUSION DE LA APP ME PARECE 
4. Si da un segmentacion fault como puedo lograr que el archivo vuelva a estar up digamos ? porque puede cromar por cualquier cosa inclusive por errores no en el codigo como lo recupero en esos fallos ?
5. ARREGLAR LA PARTE DE SECURITY



Analiza todos los archivos del proyecto (excluyendo la carpeta frontend) y crea un diagrama completo de la arquitectura del sistema DataSync. 

INSTRUCCIONES:
1. Lee todos los archivos .h, .cpp, .sql, .txt, .sh, .cmake en el proyecto
2. Excluye completamente la carpeta frontend/
3. Identifica las clases principales, sus relaciones y dependencias
4. Muestra el flujo de datos entre componentes
5. Incluye las conexiones a bases de datos (PostgreSQL, MariaDB, MSSQL, MongoDB)
6. Muestra el patr√≥n de conexiones (ConnectionPool vs conexiones directas)
7. Incluye el sistema de logging y configuraci√≥n

COMPONENTES A ANALIZAR:
- CatalogManager (catalog_manager.h)
- ConnectionPool (ConnectionPool.h/cpp)
- StreamingData (StreamingData.h)
- DDLExporter (DDLExporter.h/cpp)
- DataQuality (DataQuality.h/cpp)
- DataGovernance (DataGovernance.h/cpp)
- SyncReporter (SyncReporter.h/cpp)
- MetricsCollector (MetricsCollector.h/cpp)
- Logger (logger.h/cpp)
- Config (Config.h/cpp)
- Archivos de sincronizaci√≥n (MariaDBToPostgres.h, MSSQLToPostgres.h, etc.)

FORMATO DEL DIAGRAMA:
Usa Mermaid con:
- Rect√°ngulos para clases principales
- C√≠rculos para bases de datos
- Flechas para dependencias y flujos
- Colores diferentes para tipos de componentes
- Agrupa componentes relacionados

INCLUYE:
- Arquitectura general del sistema
- Flujo de sincronizaci√≥n de datos
- Patrones de conexi√≥n a BD
- Sistema de logging y monitoreo
- Gesti√≥n de cat√°logo de metadatos
- Procesos de limpieza y mantenimiento

Genera un diagrama detallado que muestre c√≥mo todos estos componentes trabajan juntos en el sistema DataSync.




BUGS:

[UNKNOWN]DETAIL: Key (player_id)=(6315565) already exists.
[UNKNOWN]CONTEXT: COPY players_scrubber, line 1
2025-09-21 16:00:26.811[ERROR][transferDataMariaDBToPostgres]COPY failed: Failure during '[END COPY]': ERROR: duplicate key value violates unique constraint "players_scrubber_pkey"
[UNKNOWN]DETAIL: Key (player_id)=(6315568) already exists.
[UNKNOWN]CONTEXT: COPY players_scrubber, line 1
2025-09-21 16:00:30.259[ERROR][transferDataMariaDBToPostgres]COPY failed: Failure during '[END COPY]': ERROR: duplicate key value violates unique constraint "players_scrubber_pkey"
[UNKNOWN]DETAIL: Key (player_id)=(6315574) already exists.
[UNKNOWN]CONTEXT: COPY players_scrubber, line 1
2025-09-21 16:06:20.532[ERROR][ConnectionPool]Timeout waiting for MariaDB connection


2025-09-21 16:33:48.577[WARNING][ConnectionPool]Connection validation failed, closing connection - Type: MariaDB, ID: 15
2025-09-21 16:34:18.577[ERROR][ConnectionPool]Timeout waiting for MariaDB connection




[UNKNOWN] - Idle connections: 5
[UNKNOWN] - Failed connections: 0
2025-09-21 16:12:10.333[INFO][transferDataMariaDBToPostgres]Processing chunk of 12 rows for account_service_jetu.players
2025-09-21 16:12:10.335[INFO][transferDataMariaDBToPostgres]Successfully copied 12 rows to account_service_jetu.players
2025-09-21 16:12:10.335[DEBUG][transferDataMariaDBToPostgres]Updated last_offset to 3815119 for account_service_jetu.players
2025-09-21 16:12:10.335[INFO][transferDataMariaDBToPostgres]Table account_service_jetu.players synchronized - PERFECT_MATCH
2025-09-21 16:12:11.163[DEBUG][ConnectionPool]Connection returned - Type: MariaDB, ID: 8
[UNKNOWN]Pool Status:
[UNKNOWN] - Total connections: 6
[UNKNOWN] - Active connections: -1
[UNKNOWN] - Idle connections: 6
[UNKNOWN] - Failed connections: 0
2025-09-21 16:12:11.163[WARNING][ConnectionPool]Invalid connection, creating new one
2025-09-21 16:12:11.164[DEBUG][ConnectionPool]Created MariaDB connection (ID: 9)
2025-09-21 16:12:11.164[DEBUG][ConnectionPool]Connection acquired - Type: MariaDB, ID: 9
[UNKNOWN]Pool Status:
[UNKNOWN] - Total connections: 6
[UNKNOWN] - Active connections: 0
[UNKNOWN] - Idle connections: 5
[UNKNOWN] - Failed connections: 0
2025-09-21 16:12:12.296[INFO][transferDataMariaDBToPostgres]Processing chunk of 12 rows for account_service_jetu.players_cashier
2025-09-21 16:12:12.297[INFO][transferDataMariaDBToPostgres]Successfully copied 12 rows to account_service_jetu.players_cashier
2025-09-21 16:12:12.298[DEBUG][transferDataMariaDBToPostgres]Updated last_offset to 3811348 for account_service_jetu.players_cashier
2025-09-21 16:12:12.298[INFO][transferDataMariaDBToPostgres]Table account_service_jetu.players_cashier synchronized - PERFECT_MATCH
2025-09-21 16:12:12.699[DEBUG][ConnectionPool]Connection returned - Type: MariaDB, ID: 9
[UNKNOWN]Pool Status:
[UNKNOWN] - Total connections: 6
[UNKNOWN] - Active connections: -1
[UNKNOWN] - Idle connections: 6
[UNKNOWN] - Failed connections: 0
2025-09-21 16:12:12.699[WARNING][ConnectionPool]Invalid connection, creating new one
2025-09-21 16:12:12.699[DEBUG][ConnectionPool]Created MariaDB connection (ID: 10)
2025-09-21 16:12:12.700[DEBUG][ConnectionPool]Connection acquired - Type: MariaDB, ID: 10
[UNKNOWN]Pool Status:
[UNKNOWN] - Total connections: 6
[UNKNOWN] - Active connections: 0
[UNKNOWN] - Idle connections: 5






‚óè ACTIVE USERS
Username	Role	Status	Last Activity	Client IP	Application
Datalake_User	SUPERUSER	ACTIVE	-	10.12.240.40	-
Datalake_User	SUPERUSER	IDLE	-	127.0.0.1	-
Datalake_User	SUPERUSER	IDLE	-	127.0.0.1	-
Datalake_User	SUPERUSER	IDLE	-	127.0.0.1	-
Datalake_User	SUPERUSER	IDLE	-	10.0.160.45	Redgate Monitor - Monitoring
Datalake_User	SUPERUSER	IDLE	-	10.0.160.45	Redgate Monitor - Monitoring
Datalake_User	SUPERUSER	IDLE	-	10.0.160.45	Redgate Monitor - Monitoring
Datalake_User	SUPERUSER	IDLE	-	10.0.160.45	Redgate Monitor - Monitoring
Datalake_User	SUPERUSER	IDLE	-	10.0.160.45	Redgate Monitor - Monitoring
Datalake_User	SUPERUSER	IDLE	-	10.0.160.45	Redgate Monitor - Monitoring
Datalake_User	SUPERUSER	IDLE	-	10.0.160.45	Redgate Monitor - Monitoring
Datalake_User	SUPERUSER	ACTIVE	-	10.12.240.40	-
Datalake_User	SUPERUSER	IDLE	-	10.0.89.89	DataGrip 2024.3.5
Datalake_User	SUPERUSER	IDLE	-	10.0.89.89	DataGrip 2024.3.5
Datalake_User	SUPERUSER	IDLE	-	10.0.89.89	DataGrip 2024.3.5
Datalake_User	SUPERUSER	IDLE	-	10.0.89.89	DataGrip 2024.3.5
change_management	SUPERUSER	IDLE	-	10.5.160.41	-
change_management	SUPERUSER	IDLE	-	10.5.160.41	-
Datalake_User	SUPERUSER	IDLE	-	10.0.89.89	DataGrip 2024.3.5
Datalake_User	SUPERUSER	IDLE	-	10.0.89.89	DataGrip 2024.3.5



gcc -g -O0 -o DataSync main.c



2025-09-21 17:00:11.193[DEBUG][compareAndUpdateRecord]Updated record in communication_service.chat_surveys WHERE "id" = '212143'
2025-09-21 17:00:11.195[DEBUG][compareAndUpdateRecord]Updated record in communication_service.chat_surveys WHERE "id" = '212146'
2025-09-21 17:00:11.197[DEBUG][compareAndUpdateRecord]Updated record in communication_service.chat_surveys WHERE "id" = '212149'
2025-09-21 17:00:11.197[INFO][processUpdatesByPrimaryKey]Updated 105008 records in communication_service.chat_surveys
2025-09-21 17:00:12.016[WARNING][ConnectionPool]Connection validation failed, closing connection - Type: MariaDB, ID: 14
2025-09-21 17:00:12.018[INFO][MariaDBToPostgres]Transfer completed successfully


2025-09-21 17:00:56.171[DEBUG][ConnectionPool]Starting idle connection cleanup
[UNKNOWN]Current Pool Status:
[UNKNOWN] - Total connections: 0
[UNKNOWN] - Active connections: -2
[UNKNOWN] - Idle connections: 0
[UNKNOWN] - Failed connections: 0

por que esos numeros



creo que el connection pool es problematico talvez ni los archivos de transferencia lo estan usando hay que verificarlo porque si nos cagaba el quality y el otro talvez por eso los segmentation full 


‚ñ† CONNECTION POOLING
‚îú‚îÄ Total Pools: 4 (PG, MSSQL, MariaDB, MongoDB)
‚îú‚îÄ Active Connections: 18446744073709551614
‚îú‚îÄ Idle Connections: 0
‚îú‚îÄ Failed Connections: 0
‚îî‚îÄ Last Cleanup: 0m ago

‚ñ≤ RECENT ACTIVITY (Last Hour)
‚îú‚îÄ Transfers: 1
‚îú‚îÄ Errors: 0
‚îî‚îÄ Uptime: 5d 03h 03m

‚óÑ 17:03:05 | Press Ctrl+C to exit
==2049595== Invalid read of size 8
==2049595==    at 0x464646: std::__shared_ptr<void, (__gnu_cxx::_Lock_policy)2>::get() const (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x462A27: std::shared_ptr<MYSQL> std::static_pointer_cast<MYSQL, void>(std::shared_ptr<void> const&) (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x45E8BF: std::shared_ptr<MYSQL> ConnectionGuard::get<MYSQL>() const (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x42B451: MariaDBToPostgres::transferDataMariaDBToPostgres() (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x458AA3: StreamingData::run() (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x40E2B6: main (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==  Address 0x0 is not stack'd, malloc'd or (recently) free'd
==2049595==
==2049595==
==2049595== Process terminating with default action of signal 11 (SIGSEGV)
==2049595==  Access not within mapped region at address 0x0
==2049595==    at 0x464646: std::__shared_ptr<void, (__gnu_cxx::_Lock_policy)2>::get() const (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x462A27: std::shared_ptr<MYSQL> std::static_pointer_cast<MYSQL, void>(std::shared_ptr<void> const&) (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x45E8BF: std::shared_ptr<MYSQL> ConnectionGuard::get<MYSQL>() const (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x42B451: MariaDBToPostgres::transferDataMariaDBToPostgres() (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x458AA3: StreamingData::run() (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==    by 0x40E2B6: main (in /home/tomy.berrios/Compiler-feature-15dd514/DataSync)
==2049595==  If you believe this happened as a result of a stack
==2049595==  overflow in your program's main thread (unlikely but
==2049595==  possible), you can try to increase the size of the
==2049595==  main thread stack using the --main-stacksize= flag.
==2049595==  The main thread stack size used in this run was 8388608.
==2049595==
==2049595== HEAP SUMMARY:
==2049595==     in use at exit: 369,245 bytes in 4,414 blocks
==2049595==   total heap usage: 28,856,536 allocs, 28,852,122 frees, 5,809,906,652 bytes allocated
==2049595==
==2049595== LEAK SUMMARY:
==2049595==    definitely lost: 0 bytes in 0 blocks
==2049595==    indirectly lost: 0 bytes in 0 blocks
==2049595==      possibly lost: 368 bytes in 1 blocks
==2049595==    still reachable: 368,877 bytes in 4,413 blocks
==2049595==         suppressed: 0 bytes in 0 blocks
==2049595== Rerun with --leak-check=full to see details of leaked memory
==2049595==
==2049595== Use --track-origins=yes to see where uninitialised values come from
==2049595== For lists of detected and suppressed errors, rerun with: -s
==2049595== ERROR SUMMARY: 32 errors from 6 contexts (suppressed: 0 from 0)
Segmentation fault (core dumped)
[tomy.berrios@datalake Compiler-feature-15dd514]$

‚úÖ Resumen simple:

Si el puntero es nulo ‚Üí no lo uses.

Si el puntero es v√°lido ‚Üí √∫salo normalmente.

üéØ Interpretaci√≥n exacta:

En alg√∫n punto de tu c√≥digo, guard√°s una conexi√≥n (probablemente a MariaDB) dentro de un std::shared_ptr<void>.

Luego hac√©s un static_pointer_cast<MYSQL> para usarla.

Pero ese shared_ptr est√° vac√≠o (nullptr).

Entonces .get() devuelve nullptr, y al usar ese puntero, explota.

üß© ¬øD√≥nde ocurre?

En esta cadena de funciones:

MariaDBToPostgres::transferDataMariaDBToPostgres() ‚Äî funci√≥n principal que hace el traspaso.

ConnectionGuard::get<MYSQL>() ‚Äî devuelve el puntero al objeto MYSQL.

static_pointer_cast<MYSQL, void> ‚Äî hace el cast.

shared_ptr<void>::get() ‚Äî intenta acceder al puntero, que es nullptr.

efectivamente el connection pool me esta cagando el codigo mejor abrir y cerrar conexiones creo yo 
